<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Wayfarer Helper - Collage</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
  body{font-family:system-ui,Segoe UI,Arial;margin:0;padding:0;background:#f4f6f9;color:#333;}
  header{background:#0b84ff;color:#fff;padding:14px;text-align:center;font-size:20px;font-weight:bold}
  section{margin:20px auto;max-width:1100px;padding:14px;background:#fff;border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,0.1)}
  h2{margin:0 0 12px;color:#0b84ff;font-size:18px}
  .controls-row{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
  button{padding:8px 14px;border-radius:6px;border:0;cursor:pointer;font-size:14px;transition:0.2s}
  button.primary{background:#0b84ff;color:#fff}
  button.primary:hover{background:#006ad1}
  button.secondary{background:#eee}
  button.secondary:hover{background:#ddd}
  .files-wrap{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px;max-height:480px;overflow-y:auto;padding:6px}
  .file-card{position:relative;border:1px solid #ddd;border-radius:8px;overflow:hidden;background:#fafafa;cursor:pointer;transition:0.2s}
  .file-card:hover{box-shadow:0 2px 6px rgba(0,0,0,0.2)}
  .file-card img{width:100%;height:120px;object-fit:cover;display:block}
  .file-check{position:absolute;top:6px;left:6px;width:22px;height:22px;border-radius:50%;background:#fff;border:2px solid #0b84ff;display:flex;align-items:center;justify-content:center;font-size:14px;color:#0b84ff}
  .file-card.selected .file-check{background:#0b84ff;color:#fff}
  .file-num{position:absolute;bottom:6px;right:6px;background:rgba(0,0,0,0.6);color:#fff;padding:2px 6px;border-radius:6px;font-size:12px}
</style>
</head>
<body>
  <header>ðŸ“¸ Wayfarer Helper - Collage</header>

  <!-- 1. Conectar y listar fotos -->
  <section>
    <h2>1) Conectar y listar fotos (Drive)</h2>
    <div class="controls-row">
      <button id="btnConnect" class="primary">Conectar y listar</button>
      <button id="btnRefresh" class="secondary">Refrescar</button>
      <button id="btnSelectAll" class="secondary">Seleccionar todo</button>
      <button id="btnClearAll" class="secondary">Limpiar selecciÃ³n</button>
    </div>
    <div id="filesList" class="files-wrap"></div>
  </section>

<script>
/* ===== CONFIG ===== */
const API_KEY = "AIzaSyAzq7mmTZTExpbetLRCkbopY5pDPBvOki4";
const FOLDER_ID = "1SykigPCl4e003n6i2_PbopBrq22droo4";
const SHEET_URL = "https://script.google.com/macros/s/AKfycby0mJlQC7FMR18yS_kPLRuUDw3CbaWEFXuzQqGzuT6jkVdF-53TPvCeUW8UaBxRQWpT/exec";

let files = [];
let selected = new Set();

/* === 1. Listar archivos de Drive === */
async function listDriveFiles(){
  const url = `https://www.googleapis.com/drive/v3/files?q='${FOLDER_ID}'+in+parents&key=${API_KEY}&fields=files(id,name,mimeType,thumbnailLink,webContentLink)`;
  const res = await fetch(url);
  const data = await res.json();
  files = data.files || [];
  renderFiles();
}

/* === Renderizar lista === */
function renderFiles(){
  const cont = document.getElementById("filesList");
  cont.innerHTML = "";
  files.forEach((f,i)=>{
    const isSel = selected.has(f.id);
    // aseguramos thumbnail
    const thumb = f.thumbnailLink 
      ? f.thumbnailLink.replace(/=s\d+$/, "=s200") 
      : `https://drive.google.com/uc?export=view&id=${f.id}`;

    const div = document.createElement("div");
    div.className = "file-card"+(isSel?" selected":"");
    div.innerHTML = `
      <div class="file-check">${isSel?"âœ“":""}</div>
      <img src="${thumb}" alt="${f.name}">
      <div class="file-num">#${i+1}</div>
    `;
    div.onclick = ()=>{
      if(selected.has(f.id)) selected.delete(f.id);
      else selected.add(f.id);
      renderFiles();
    };
    cont.appendChild(div);
  });
}

/* === Botones === */
document.getElementById("btnConnect").onclick = listDriveFiles;
document.getElementById("btnRefresh").onclick = listDriveFiles;
document.getElementById("btnSelectAll").onclick = ()=>{
  files.forEach(f=>selected.add(f.id));
  renderFiles();
};
document.getElementById("btnClearAll").onclick = ()=>{
  selected.clear();
  renderFiles();
};
</script>
</body>
</html>
