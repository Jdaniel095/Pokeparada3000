<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Pokeparada 3000</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { margin-top: 40px; }

    .gallery { display: flex; flex-wrap: wrap; gap: 10px; }
    .gallery img { border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.2); cursor: pointer; transition: transform 0.2s; }
    .gallery img:hover { transform: scale(1.1); }

    .collage { margin-top: 20px; }
    .collage img { border: 2px solid #333; border-radius: 10px; max-width: 100%; display:block; margin-bottom:10px; }

    #map { height: 300px; width: 100%; margin-top: 20px; border-radius: 8px; cursor:pointer; }

    button { padding: 8px 12px; border: none; border-radius: 6px; background: #4CAF50; color: #fff; cursor: pointer; margin-top: 10px; }
    button:hover { background: #45a049; }

    /* Modal para mapa grande */
    #mapModal {
      display: none;
      position: fixed;
      z-index: 999;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      align-items: center;
      justify-content: center;
    }
    #mapLarge {
      width: 90%;
      height: 80%;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>

<h1>游늸 Pokeparada 3000</h1>

<!-- Galer칤a de im치genes desde Drive -->
<h2>Galer칤a de Google Drive</h2>
<div class="gallery" id="gallery"></div>

<!-- Collage generado -->
<h2>Collage generado</h2>
<div class="collage" id="collage">
  <p>A칰n no hay collage.</p>
</div>
<button onclick="generateCollage()">Generar Collage</button>
<a id="downloadLink" style="display:none;" download="collage.png">
  <button>游닌 Descargar Collage</button>
</a>

<!-- Mapa -->
<h2>Mapa de coordenadas</h2>
<div id="map"></div>
<button onclick="saveLocation()">Guardar ubicaci칩n</button>

<!-- Modal con mapa grande -->
<div id="mapModal" onclick="closeMapModal()">
  <div id="mapLarge"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  // 游댳 IDs de archivos en tu carpeta de Drive (pon los tuyos aqu칤)
  const fileIds = [
    "1SykigPCl4e003n6i2_PbopBrq22droo4", // ejemplo
    // "OTRO_ID"
  ];

  const gallery = document.getElementById("gallery");
  const collageDiv = document.getElementById("collage");
  const downloadLink = document.getElementById("downloadLink");

  let selectedImages = [];

  // Mostrar im치genes con miniaturas reales de Drive
  fileIds.forEach(id => {
    const thumbUrl = `https://drive.google.com/thumbnail?id=${id}&sz=w300-h300`;
    const fullUrl = `https://drive.google.com/uc?export=view&id=${id}`;

    const img = document.createElement("img");
    img.src = thumbUrl;
    img.width = 150;

    img.onclick = () => {
      if (selectedImages.includes(fullUrl)) {
        selectedImages = selectedImages.filter(x => x !== fullUrl);
        img.style.border = "none";
      } else {
        selectedImages.push(fullUrl);
        img.style.border = "3px solid red";
      }
    };

    gallery.appendChild(img);
  });

  // Generar collage como miniatura + descarga
  function generateCollage() {
    if (selectedImages.length === 0) {
      collageDiv.innerHTML = "<p>Selecciona im치genes para crear un collage.</p>";
      downloadLink.style.display = "none";
      return;
    }

    collageDiv.innerHTML = "";
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    const size = 200;
    const cols = Math.ceil(Math.sqrt(selectedImages.length));
    const rows = Math.ceil(selectedImages.length / cols);
    canvas.width = cols * size;
    canvas.height = rows * size;

    let loaded = 0;
    selectedImages.forEach((url, i) => {
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.src = url;
      img.onload = () => {
        const x = (i % cols) * size;
        const y = Math.floor(i / cols) * size;
        ctx.drawImage(img, x, y, size, size);
        ctx.fillStyle = "white";
        ctx.font = "20px Arial";
        ctx.fillText(i + 1, x + 10, y + 25);

        loaded++;
        if (loaded === selectedImages.length) {
          const collageImg = new Image();
          const dataUrl = canvas.toDataURL("image/png");
          collageImg.src = dataUrl;
          collageImg.width = 400;
          collageDiv.innerHTML = "";
          collageDiv.appendChild(collageImg);

          // activar bot칩n de descarga
          downloadLink.href = dataUrl;
          downloadLink.style.display = "inline-block";
        }
      };
    });
  }

  // Mapa interactivo con Leaflet (mini mapa)
  const map = L.map('map').setView([0, 0], 2);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '춸 OpenStreetMap contributors'
  }).addTo(map);

  let marker;
  let savedCoords = null;

  function saveLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;
        savedCoords = [lat, lng];

        if (marker) map.removeLayer(marker);
        marker = L.marker(savedCoords).addTo(map);

        map.setView(savedCoords, 16);
      });
    } else {
      alert("La geolocalizaci칩n no est치 soportada en este navegador.");
    }
  }

  // Abrir mapa grande en modal
  document.getElementById("map").onclick = () => {
    if (!savedCoords) return;
    document.getElementById("mapModal").style.display = "flex";
    setTimeout(() => {
      const mapLarge = L.map('mapLarge').setView(savedCoords, 18);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '춸 OpenStreetMap contributors'
      }).addTo(mapLarge);
      L.marker(savedCoords).addTo(mapLarge);
    }, 100);
  };

  function closeMapModal() {
    document.getElementById("mapModal").style.display = "none";
    document.getElementById("mapLarge").innerHTML = ""; // limpiar para evitar duplicados
  }
</script>

</body>
</html>
